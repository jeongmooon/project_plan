---
layout : post
title : "[node] JWT? Cookie? Session?"
---

# 이것들을 왜 사용 하는가?

### HTTP 프토토콜의 특징(비연결지향 & 상태정보유지 안함)
HTTP는 request를 서버에 보내고, 서버에서 response를 받고 끊는다
이것의 장점은 ***통신연결을 유지하지 않아 리소스 낭비가 줄어***드는 것이고
단점은 ***통신할때마다 새로운 커넥션이 열려 클라이언트에 내가 누군지 인증***해야 하는 것이다.

때문에 위에 것들을 사용해서 상태를 관리한다.

### 쿠키(Cookie)란?

- 클라이언트 로컬에 저장되는 키와 값이 들어간 데이터 파일
- 이름, 값, 저장기간, 경로정보 가 저장됨
- 쿠키에 클라이언트 상태정보를 로컬에 저장하고 참조

### 세션(Session)이란?

웹 브라우저를 통해 웹 서버로 저속한 이 후 브라우저를 종료할 때까지 접속 유지하는 상태

서버에 세션ID를 만들고, 그걸 클라이언트로 발급해준 세션ID를 쿠키를 통해 저장함
다시 접속 할 때, 이 것을 이용하여 세션ID값을 서버로 전달하여 자동 로그인함

### 토큰(JsonWebToken)이란?

JWT는 인증에 필요한 정보들을 암호화 시킨 토큰이다.
인증에 필요한 정보(예를 들면 objectID 같이 필요 없지만 유니크한 값)을 암호화 하고
그 토큰을 담아서 HTTP헤더에 넣어준다.


### 세가지의 차이점
> 저장위치 : 쿠키와 토큰은 클라이언트, 세션은 DB에 저장
> 보안 : 세션은 DB에 저장해서 강함, 쿠키랑 토큰은 탈취당할 위험이 있긴함
> 저장시간 : 쿠키와 토큰은 종료해도 시간전까지 저장되서 악의적이용가능
            세션은 만료시간과 관계없이 브라우저 종료시 삭제
> 속도 : 토큰과 쿠키는 빠름(정보가 이미있어서), 세션은 DB에 있어서 느림

결론 쿠키와 토큰은 비슷하지만 세션은 조금 다른 느낌이다.

이렇게 적고보면 토큰이 좋아보이지만 또 그렇지도 않기도 하고, 상황에 따라 
사용하는 것이 좋을 것 같다.


### JWT사용법 

**npm install jwt**하고 ***SecreKey*** 값은 실수로라도 외부에 유출되지 않도록
Config폴더나 .env에 넣고 호출하는 형태로 하는 것이 좋다.

모듈화해서 사용하는 것이 좋다. 왜냐하면 이곳 저곳에 사용 될 수도 있기 때문이다.
또한 토큰을 create할 때, palyload 값으로 사용자의 비밀번호는 당연히 안되고,
이메일, 이름같은 것도 사용하지 않는 것이 좋다. objectID 같은 값같은 유니크하지만
상대적으로 덜 중요한 정보로 만드는 것이 좋다.

#### SecretKey를 따로 보관하는 이유

이건 암호화 할 때도 같은 것으로, 이것으로 토큰을 만들고 복호화를 한다.
때문에 사용자에 대한 정보를 탈취당 할 위험이 있기 때문에 공개되지 않도록 설정한다.


#### Refresh Token?

우리가 위에서 만들었던 토큰은 AccessToken으로 이 것의 문제는 위에도 적었듯이,
누군가가 탈취하면 만료전까지는 막을 수 없는 것다. 그렇기에 토큰은 기간을 1시간
같이 짧게 설정을하는데, 이러면 자주 로그인해서 있나 없나 똑같은 불편함을 겪는다.

이걸 ***Refresh Tokoken***으로 해결한다. AcessToken과 차이점은 유효기간이 길고,
이 토큰으로 만료된 AcessToken을 다시 받아오는 형식이다.

사실 refresh token도 보안을 물고 늘어지면 끝이 없는 것 같다. 하지만 간단하게 말하면
access token의 안정성 확보를 위해 만료기간을 짧게 잡았고, 그것을 보완하기 위해
refresh token이 생겼다 는 것 같다.

## 결론?
이걸 보면서 refresh token과 세션, 쿠키에 대해서 자료를 찾아보고 읽어 보았는데
사람들마다 토큰 쪽은 생각이 많이 갈리는 것 같았다.
refresh token은 access token과 다르게 서버에서 방어를 할 여지를 주는 것 같다.
이유는 access token은 stateless 특성 때문에 탈취당하면 서버에선 정상적인
사용자라고 인식하기 때문이다.

내용이 공부할 수록 어지러워서 재미는 있었다.